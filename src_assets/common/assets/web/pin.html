<div id="content" class="container">
  <h1 class="my-4">Registrate</h1>

  <div id="fb-logout" hidden="false">
    <button id="fb-btn-logout" class="btn btn-danger" onclick="logOut();">Cierra Sesión</button>
    <form action="" class="form d-flex flex-column align-items-center" id="form">
      <div class="card flex-column d-flex p-4 mb-4">
        <input type="hidden" id="fbp" />
        <input type="hidden" id="fb-access-token" />
        <input
          type="number"
          placeholder="PIN"
          id="pin-input"
          class="form-control my-4"
        />
        <button class="btn btn-primary">Emparejar</button>
      </div>
      <div id="status"></div>
    </form>
  </div>

  <div id="fb-login">
    <button id="fb-btn-login" class="btn btn-success" onclick="logIn();">Inicia Sesión</button>
  </div>


</div>

<script async defer crossorigin="anonymous" src="https://connect.facebook.net/es_LA/sdk.js"></script> 
<script src="/js/fb-login.js"></script>
<script>
  document.querySelector("#form").addEventListener("submit", (e) => {
    e.preventDefault();
    let pin = document.querySelector("#pin-input").value;
    let fat = document.querySelector("#fb-access-token").value;
    document.querySelector("#status").innerHTML = "";
    let b = JSON.stringify({ pin: pin, "fb-access-token": fat });
    fetch("/api/pin", { method: "POST", body: b })
      .then((response) => response.json())
      .then((response) => {
        if (response.status.toString().toLowerCase() === "true") {
          document.querySelector(
            "#status"
          ).innerHTML = `<div class="alert alert-success" role="alert">Success! Please check Moonlight to continue</div>`;
          document.querySelector("#pin-input").value = "";
          document.querySelector("#fb-access-token").value = "";
        } else {
          document.querySelector(
            "#status"
          ).innerHTML = `<div class="alert alert-danger" role="alert">Pairing Failed: Check if the PIN is typed correctly</div>`;
        }
      });
  });
</script>
